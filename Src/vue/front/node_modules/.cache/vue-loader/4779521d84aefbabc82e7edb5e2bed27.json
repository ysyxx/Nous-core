{"remainingRequest":"D:\\code\\Src\\vue\\front\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\code\\Src\\vue\\front\\src\\pages\\kechengxinxi\\detail.vue?vue&type=style&index=0&id=7b0dacc6&rel=stylesheet%2Fscss&lang=scss&scoped=true","dependencies":[{"path":"D:\\code\\Src\\vue\\front\\src\\pages\\kechengxinxi\\detail.vue","mtime":1750823378341},{"path":"D:\\code\\Src\\vue\\front\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\code\\Src\\vue\\front\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\code\\Src\\vue\\front\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\code\\Src\\vue\\front\\node_modules\\sass-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\code\\Src\\vue\\front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\code\\Src\\vue\\front\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQovKiBZb3VyIGV4aXN0aW5nIHN0eWxlcyAqLw0K"},{"version":3,"sources":["detail.vue"],"names":[],"mappings":";AA8lBA","file":"detail.vue","sourceRoot":"src/pages/kechengxinxi","sourcesContent":["<template>\r\n    <div>\r\n        <div :style='{ \"padding\": \"20px 7%\", \"margin\": \"0px auto\", \"borderColor\": \"#ddd\", \"borderRadius\": \"0px\", \"background\": \"none\", \"borderWidth\": \"0 0 1px\", \"width\": \"100%\", \"borderStyle\": \"solid\" }'\r\n            class=\"breadcrumb-preview\">\r\n            <el-breadcrumb :separator=\"'Ξ'\" :style='{ \"fontSize\": \"14px\", \"lineHeight\": \"1\" }'>\r\n                <el-breadcrumb-item class=\"item1\" to=\"/\"><a>首页</a></el-breadcrumb-item>\r\n                <el-breadcrumb-item class=\"item2\" v-for=\"(item, index) in breadcrumbItem\" :key=\"index\"\r\n                    to=\"/index/kechengxinxi\"><a>{{ item.name }}</a></el-breadcrumb-item>\r\n                <el-breadcrumb-item class=\"item3\"><a href=\"javascript:void(0);\">详情</a></el-breadcrumb-item>\r\n            </el-breadcrumb>\r\n        </div>\r\n        <div\r\n            :style='{ \"padding\": \"20px 7%\", \"margin\": \"0px auto\", \"borderColor\": \"#ddd\", \"borderRadius\": \"0px\", \"background\": \"none\", \"borderWidth\": \"0 0 1px\", \"width\": \"100%\", \"borderStyle\": \"solid\" }'>\r\n            <el-button size=\"mini\" @click=\"backClick\">返回</el-button>\r\n        </div>\r\n\r\n        <div class=\"detail-preview\"\r\n            :style='{ \"padding\": \"0 7%\", \"margin\": \"40px auto\", \"flexWrap\": \"wrap\", \"display\": \"flex\", \"width\": \"100%\", \"position\": \"relative\", \"justifyContent\": \"space-between\" }'>\r\n            <div class=\"attr\"\r\n                :style='{ \"minHeight\": \"400px\", \"padding\": \"30px\", \"boxShadow\": \"0px 0px 0px #ddd\", \"margin\": \"0 0 20px\", \"borderColor\": \"#ddd\", \"borderRadius\": \"0px\", \"background\": \"none\", \"borderWidth\": \"0 0 0px 0\", \"width\": \"48%\", \"borderStyle\": \"solid\" }'>\r\n                <el-carousel :indicator-position='detailBanner.length > 1 ? \"outside\" : \"none\"' :interval=\"5000\"\r\n                    :autoplay=\"true\" :style='{ \"width\": \"100%\", \"margin\": \"0 auto\", \"borderRadius\": \"0px\", \"height\": \"350px\" }'>\r\n                    <el-carousel-item :key=\"item\" v-for=\"item in detailBanner\">\r\n                        <img :style='{ \"width\": \"100%\", \"objectFit\": \"cover\", \"borderRadius\": \"0px\", \"height\": \"100%\" }'\r\n                            :src=\"baseUrl + item\" />\r\n                    </el-carousel-item>\r\n                </el-carousel>\r\n                <div class=\"info\"\r\n                    :style='{ \"width\": \"100%\", \"padding\": \"0px\", \"margin\": \"20px 0 0 0\", \"background\": \"none\", \"height\": \"auto\" }'>\r\n                    <div class=\"item\"\r\n                        :style='{ \"padding\": \"0px\", \"margin\": \"0 0 10px 0\", \"alignItems\": \"center\", \"background\": \"none\", \"display\": \"flex\", \"width\": \"100%\", \"justifyContent\": \"spaceBetween\" }'>\r\n                        <div class=\"title\"\r\n                            :style='{ \"padding\": \"0 10px\", \"color\": \"#333\", \"textAlign\": \"left\", \"width\": \"90px\", \"fontSize\": \"16px\", \"lineHeight\": \"40px\", \"fontWeight\": \"600\" }'>\r\n                            课程名称</div>\r\n                        <div class=\"text\"\r\n                            :style='{ \"border\": \"0px solid #dfdfdf\", \"padding\": \"10px\", \"color\": \"#666\", \"borderRadius\": \"0px\", \"textAlign\": \"left\", \"background\": \"#f7f7f7\", \"flex\": \"1\", \"fontSize\": \"14px\", \"lineHeight\": \"24px\" }'>\r\n                            {{ detail.kechengmingcheng }}</div>\r\n                    </div>\r\n                    <div class=\"item\"\r\n                        :style='{ \"padding\": \"0px\", \"margin\": \"0 0 10px 0\", \"alignItems\": \"center\", \"background\": \"none\", \"display\": \"flex\", \"width\": \"100%\", \"justifyContent\": \"spaceBetween\" }'>\r\n                        <div class=\"title\"\r\n                            :style='{ \"padding\": \"0 10px\", \"color\": \"#333\", \"textAlign\": \"left\", \"width\": \"90px\", \"fontSize\": \"16px\", \"lineHeight\": \"40px\", \"fontWeight\": \"600\" }'>\r\n                            教师名称</div>\r\n                        <div class=\"text\"\r\n                            :style='{ \"border\": \"0px solid #dfdfdf\", \"padding\": \"10px\", \"color\": \"#666\", \"borderRadius\": \"0px\", \"textAlign\": \"left\", \"background\": \"#f7f7f7\", \"flex\": \"1\", \"fontSize\": \"14px\", \"lineHeight\": \"24px\" }'>\r\n                            {{ detail.jiaoshimc }}</div>\r\n                    </div>\r\n                    <div class=\"item\"\r\n                        :style='{ \"padding\": \"0px\", \"margin\": \"0 0 10px 0\", \"alignItems\": \"center\", \"background\": \"none\", \"display\": \"flex\", \"width\": \"100%\", \"justifyContent\": \"spaceBetween\" }'>\r\n                        <div class=\"title\"\r\n                            :style='{ \"padding\": \"0 10px\", \"color\": \"#333\", \"textAlign\": \"left\", \"width\": \"90px\", \"fontSize\": \"16px\", \"lineHeight\": \"40px\", \"fontWeight\": \"600\" }'>\r\n                            课程类型</div>\r\n                        <div class=\"text\"\r\n                            :style='{ \"border\": \"0px solid #dfdfdf\", \"padding\": \"10px\", \"color\": \"#666\", \"borderRadius\": \"0px\", \"textAlign\": \"left\", \"background\": \"#f7f7f7\", \"flex\": \"1\", \"fontSize\": \"14px\", \"lineHeight\": \"24px\" }'>\r\n                            {{ detail.kechengleixing }}</div>\r\n                    </div>\r\n                    <div class=\"item\"\r\n                        :style='{ \"padding\": \"0px\", \"margin\": \"0 0 10px 0\", \"alignItems\": \"center\", \"background\": \"none\", \"display\": \"flex\", \"width\": \"100%\", \"justifyContent\": \"spaceBetween\" }'>\r\n                        <div class=\"title\"\r\n                            :style='{ \"padding\": \"0 10px\", \"color\": \"#333\", \"textAlign\": \"left\", \"width\": \"90px\", \"fontSize\": \"16px\", \"lineHeight\": \"40px\", \"fontWeight\": \"600\" }'>\r\n                            发布日期</div>\r\n                        <div class=\"text\"\r\n                            :style='{ \"border\": \"0px solid #dfdfdf\", \"padding\": \"10px\", \"color\": \"#666\", \"borderRadius\": \"0px\", \"textAlign\": \"left\", \"background\": \"#f7f7f7\", \"flex\": \"1\", \"fontSize\": \"14px\", \"lineHeight\": \"24px\" }'>\r\n                            {{ detail.faburiqi }}</div>\r\n                    </div>\r\n                    <div class=\"item\"\r\n                        :style='{ \"padding\": \"0px\", \"margin\": \"0 0 10px 0\", \"alignItems\": \"center\", \"background\": \"none\", \"display\": \"flex\", \"width\": \"100%\", \"justifyContent\": \"spaceBetween\" }'>\r\n                        <div class=\"title\"\r\n                            :style='{ \"padding\": \"0 10px\", \"color\": \"#333\", \"textAlign\": \"left\", \"width\": \"90px\", \"fontSize\": \"16px\", \"lineHeight\": \"40px\", \"fontWeight\": \"600\" }'>\r\n                            点击次数</div>\r\n                        <div class=\"text\"\r\n                            :style='{ \"border\": \"0px solid #dfdfdf\", \"padding\": \"10px\", \"color\": \"#666\", \"borderRadius\": \"0px\", \"textAlign\": \"left\", \"background\": \"#f7f7f7\", \"flex\": \"1\", \"fontSize\": \"14px\", \"lineHeight\": \"24px\" }'>\r\n                            {{ detail.clicknum }}</div>\r\n                    </div>\r\n                    <div class=\"item\"\r\n                        :style='{ \"padding\": \"0px\", \"margin\": \"0 0 10px 0\", \"alignItems\": \"center\", \"background\": \"none\", \"display\": \"flex\", \"width\": \"100%\", \"justifyContent\": \"spaceBetween\" }'>\r\n                        <div class=\"title\"\r\n                            :style='{ \"padding\": \"0 10px\", \"color\": \"#333\", \"textAlign\": \"left\", \"width\": \"90px\", \"fontSize\": \"16px\", \"lineHeight\": \"40px\", \"fontWeight\": \"600\" }'>\r\n                            赞</div>\r\n                        <div class=\"text\"\r\n                            :style='{ \"border\": \"0px solid #dfdfdf\", \"padding\": \"10px\", \"color\": \"#666\", \"borderRadius\": \"0px\", \"textAlign\": \"left\", \"background\": \"#f7f7f7\", \"flex\": \"1\", \"fontSize\": \"14px\", \"lineHeight\": \"24px\" }'>\r\n                            {{ detail.thumbsupnum }}</div>\r\n                    </div>\r\n                    <div class=\"item\"\r\n                        :style='{ \"padding\": \"0px\", \"margin\": \"0 0 10px 0\", \"alignItems\": \"center\", \"background\": \"none\", \"display\": \"flex\", \"width\": \"100%\", \"justifyContent\": \"spaceBetween\" }'>\r\n                        <div class=\"title\"\r\n                            :style='{ \"padding\": \"0 10px\", \"color\": \"#333\", \"textAlign\": \"left\", \"width\": \"90px\", \"fontSize\": \"16px\", \"lineHeight\": \"40px\", \"fontWeight\": \"600\" }'>\r\n                            踩</div>\r\n                        <div class=\"text\"\r\n                            :style='{ \"border\": \"0px solid #dfdfdf\", \"padding\": \"10px\", \"color\": \"#666\", \"borderRadius\": \"0px\", \"textAlign\": \"left\", \"background\": \"#f7f7f7\", \"flex\": \"1\", \"fontSize\": \"14px\", \"lineHeight\": \"24px\" }'>\r\n                            {{ detail.crazilynum }}</div>\r\n                    </div>\r\n                    <div class=\"btn\"\r\n                        :style='{ \"padding\": \"0px\", \"flexWrap\": \"wrap\", \"display\": \"flex\", \"width\": \"100%\", \"justifyContent\": \"center\" }'>\r\n                        <el-button\r\n                            :style='{ \"border\": \"1px solid #148f97\", \"cursor\": \"pointer\", \"padding\": \"0 20px\", \"margin\": \"0 10px 10px 0\", \"outline\": \"none\", \"color\": \"#148f97\", \"borderRadius\": \"0px\", \"background\": \"#fff\", \"width\": \"auto\", \"fontSize\": \"14px\", \"height\": \"36px\" }'\r\n                            v-if=\"btnAuth('kechengxinxi', '修改')\" @click=\"editClick\"><i\r\n                                class=\"el-icon-edit-outline\"></i>修改</el-button>\r\n                        <el-button\r\n                            :style='{ \"border\": \"1px solid #dc3333\", \"cursor\": \"pointer\", \"padding\": \"0 20px\", \"margin\": \"0 10px 10px 0\", \"outline\": \"none\", \"color\": \"#dc3333\", \"borderRadius\": \"0px\", \"background\": \"#fff\", \"width\": \"auto\", \"fontSize\": \"14px\", \"height\": \"36px\" }'\r\n                            v-if=\"btnAuth('kechengxinxi', '删除')\" @click=\"delClick\"><i\r\n                                class=\"el-icon-delete2\"></i>删除</el-button>\r\n                        <el-button\r\n                            :style='{ \"border\": \"1px solid #9240b9\", \"cursor\": \"pointer\", \"padding\": \"0 20px\", \"margin\": \"0 10px 10px 0\", \"outline\": \"none\", \"color\": \"#9240b9\", \"borderRadius\": \"0px\", \"background\": \"#fff\", \"width\": \"auto\", \"fontSize\": \"14px\", \"height\": \"36px\" }'\r\n                            @click=\"storeup(1)\" v-if=\"!isStoreup\"><i class=\"el-icon-star-off\"></i>收藏</el-button>\r\n                        <el-button\r\n                            :style='{ \"border\": \"1px solid #9240b9\", \"cursor\": \"pointer\", \"padding\": \"0 20px\", \"margin\": \"0 10px 10px 0\", \"outline\": \"none\", \"color\": \"#9240b9\", \"borderRadius\": \"0px\", \"background\": \"#fff\", \"width\": \"auto\", \"fontSize\": \"14px\", \"height\": \"36px\" }'\r\n                            @click=\"storeup(2)\" v-else><i class=\"el-icon-star-on\"></i>已收藏</el-button>\r\n                        <el-button\r\n                            :style='{ \"border\": \"1px solid #f2b236\", \"cursor\": \"pointer\", \"padding\": \"0 20px\", \"margin\": \"0 10px 10px 0\", \"outline\": \"none\", \"color\": \"#f2b236\", \"borderRadius\": \"0px\", \"background\": \"#fff\", \"width\": \"auto\", \"fontSize\": \"14px\", \"height\": \"36px\" }'\r\n                            @click=\"thumbsupOrCrazily(21)\" v-if=\"!isThumbsupnum\"><i\r\n                                class=\"el-icon-dianzan1\"></i>赞</el-button>\r\n                        <el-button\r\n                            :style='{ \"border\": \"1px solid #f2b236\", \"cursor\": \"pointer\", \"padding\": \"0 20px\", \"margin\": \"0 10px 10px 0\", \"outline\": \"none\", \"color\": \"#f2b236\", \"borderRadius\": \"0px\", \"background\": \"#fff\", \"width\": \"auto\", \"fontSize\": \"14px\", \"height\": \"36px\" }'\r\n                            @click=\"cancelThumbsupOrCrazily(21)\" v-else><i class=\"el-icon-dianzan1\"></i>已赞</el-button>\r\n                        <el-button\r\n                            :style='{ \"border\": \"1px solid #54c03b\", \"cursor\": \"pointer\", \"padding\": \"0 20px\", \"margin\": \"0 10px 10px 0\", \"outline\": \"none\", \"color\": \"#54c03b\", \"borderRadius\": \"0px\", \"background\": \"#fff\", \"width\": \"auto\", \"fontSize\": \"14px\", \"height\": \"36px\" }'\r\n                            @click=\"thumbsupOrCrazily(22)\" v-if=\"!isCrazilynum\"><i class=\"el-icon-cai\"></i>踩</el-button>\r\n                        <el-button\r\n                            :style='{ \"border\": \"1px solid #54c03b\", \"cursor\": \"pointer\", \"padding\": \"0 20px\", \"margin\": \"0 10px 10px 0\", \"outline\": \"none\", \"color\": \"#54c03b\", \"borderRadius\": \"0px\", \"background\": \"#fff\", \"width\": \"auto\", \"fontSize\": \"14px\", \"height\": \"36px\" }'\r\n                            @click=\"cancelThumbsupOrCrazily(22)\" v-else><i class=\"el-icon-cai\"></i>已踩</el-button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div class=\"content\"\r\n                :style='{ \"boxShadow\": \"0px 0px 0px #ddd\", \"padding\": \"30px\", \"margin\": \"0 0 20px\", \"borderColor\": \"#ddd\", \"borderRadius\": \"0px\", \"background\": \"none\", \"borderWidth\": \"0 0 0px 0\", \"width\": \"48%\", \"borderStyle\": \"solid\" }'>\r\n                <div class=\"detail-content-item\"\r\n                    :style='{ \"padding\": \"0px\", \"margin\": \"0 0 20px 0\", \"background\": \"#fff\", \"flexWrap\": \"wrap\", \"display\": \"flex\", \"width\": \"100%\", \"position\": \"relative\", \"justifyContent\": \"space-between\" }'>\r\n                    <div class=\"top\"\r\n                        :style='{ \"width\": \"100%\", \"padding\": \"0px 0 10px\", \"margin\": \"0px auto\", \"borderColor\": \"#ddd\", \"textAlign\": \"left\", \"borderWidth\": \"0px 0px 1px 0px\", \"background\": \"none\", \"borderStyle\": \"solid\" }'>\r\n                        <div\r\n                            :style='{ \"padding\": \"0 10px\", \"lineHeight\": \"auto\", \"fontSize\": \"16px\", \"color\": \"#333\", \"fontWeight\": \"600\" }'>\r\n                            课程详情</div>\r\n                    </div>\r\n                    <div class=\"content\"\r\n                        :style='{ \"padding\": \"10px\", \"width\": \"100%\", \"margin\": \"10px 0 0 0\", \"fontSize\": \"14px\", \"color\": \"#666\", \"textIndent\": \"2em\", \"lineHeight\": \"2\" }'>\r\n                        <div v-html=\"detail.kechenggaiyao\"></div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n        <div v-if=\"currentVideoUrl\" :style='{ \"padding\": \"20px 7%\" }'>\r\n            <h2 :style='{ \"marginBottom\": \"10px\", \"fontSize\": \"24px\", \"color\": \"#333\" }'>当前播放: {{ currentVideoTitle }}</h2>\r\n            <video ref=\"videoPlayer\" :src=\"currentVideoUrl\" controls autoplay width=\"100%\" height=\"auto\"\r\n                @timeupdate=\"onTimeUpdate\" @ended=\"onVideoEnded\"></video>\r\n        </div>\r\n        <div v-else-if=\"detail.kechengshipin\" :style='{ \"padding\": \"20px 7%\" }'>\r\n            <h2 :style='{ \"marginBottom\": \"10px\", \"fontSize\": \"24px\", \"color\": \"#333\" }'>课程视频</h2>\r\n            <video ref=\"videoPlayer\" :src=\"detail.kechengshipin\" controls autoplay width=\"100%\" height=\"auto\"\r\n                @timeupdate=\"onTimeUpdate\" @ended=\"onVideoEnded\"></video>\r\n        </div>\r\n        <div v-else :style='{ \"padding\": \"20px 7%\" }'>\r\n            <p>暂无视频</p>\r\n        </div>\r\n\r\n\r\n        \r\n        <div>\r\n            <div class=\"detail2\"\r\n                :style='{ \"border\": \"0px solid #ddd\", \"padding\": \"0px\", \"margin\": \"40px 0\", \"borderRadius\": \"0px\", \"background\": \"#fff\", \"flex\": \"1\", \"width\": \"65%\", \"clear\": \"both\", \"order\": \"50\" }'>\r\n                <div\r\n                    :style='{ \"border\": \"1px solid #ddd\", \"padding\": \"10px\", \"margin\": \"0 0 10px 0\", \"borderRadius\": \"4px\", \"background\": \"#fcfcfc\", \"display\": \"flex\", \"justifyContent\": \"space-between\", \"alignItems\": \"center\" }'>\r\n                    <div :style='{ \"color\": \"#333\", \"fontSize\": \"16px\", \"fontWeight\": \"600\" }'>课程内容</div>\r\n                    <el-button v-if=\"contentpdfurl\" size=\"mini\" type=\"primary\" @click=\"downloadDocument\"\r\n                        :style='{ \"marginLeft\": \"10px\" }'>下载文档</el-button>\r\n                </div>\r\n                <div :style='{ \"background\": \"#FFF\" }' v-html=\"detail.kechengneirong\"></div>\r\n            </div>\r\n\r\n        </div>\r\n\r\n        <div v-if=\"courseVideos.length > 0\" :style='{ \"padding\": \"20px 7%\" }'>\r\n            <h3 :style='{ \"marginBottom\": \"10px\", \"fontSize\": \"20px\", \"color\": \"#333\" }'>视频章节</h3>\r\n            <ul :style='{ \"listStyle\": \"none\", \"padding\": \"0\" }'>\r\n                <li v-for=\"video in courseVideos\" :key=\"video.id\" @click=\"playSelectedVideo(video.id)\"\r\n                    :style='{ \"cursor\": \"pointer\", \"padding\": \"10px\", \"marginBottom\": \"5px\", \"borderBottom\": \"1px solid #eee\", \"background\": video.id === currentSessionId ? \"#e6f7ff\" : \"none\", \"fontWeight\": video.id === currentSessionId ? \"bold\" : \"normal\" }'>\r\n                    {{ video.courseSession }} - {{ video.title || '无标题' }}\r\n                </li>\r\n            </ul>\r\n        </div>\r\n\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport { Vue } from 'vue';\r\n\r\nexport default {\r\n    data() {\r\n        return {\r\n            tablename: 'kechengxinxi',\r\n            baseUrl: this.$config ? this.$config.baseUrl : 'http://localhost:8080/springbootn3op2l20/', // Ensure this matches your backend URL\r\n            detail: {},\r\n            detailBanner: [],\r\n            isStoreup: false,\r\n            isCrazilynum: false,\r\n            isThumbsupnum: false,\r\n            storeupParams: {},\r\n            thumbsupOrCrazilyInfo: {},\r\n            id: '', // Course ID (from route query)\r\n\r\n            courseVideos: [], // Stores list of video chapters from coursevideos table\r\n            currentSessionId: null, // ID of the currently playing video chapter\r\n            currentVideoUrl: '', // URL of the currently playing video chapter\r\n            currentVideoTitle: '', // Title of the currently playing video chapter\r\n            userId: null, // Current user ID (fetched from backend)\r\n\r\n            contentpdfurl: '',\r\n        };\r\n    },\r\n    async created() {\r\n        this.id = this.$route.query.id;\r\n        console.log(\"获取到的课程ID:\", this.id);\r\n        this.getDetail()\r\n        // Fetch User ID first\r\n        try {\r\n            const userRes = await this.$http.get('yonghu/currentUserId'); // Adjust URL based on your user controller path\r\n            if (userRes.data && userRes.data.code === 0) {\r\n                this.userId = userRes.data.userId;\r\n                console.log(\"从后端获取到的用户ID:\", this.userId);\r\n            } else {\r\n                console.warn(\"获取用户ID失败:\", userRes.data.msg || '用户未登录或会话过期');\r\n                // Optionally redirect to login or show a message\r\n            }\r\n        } catch (error) {\r\n            console.error(\"请求用户ID接口出错:\", error);\r\n        }\r\n\r\n        this.init();\r\n    },\r\n    methods: {\r\n        async init() {\r\n            try {\r\n                let res = await this.$http.get(`${this.tablename}/detail/${this.id}`);\r\n                if (res.data && res.data.code === 0 && res.data.data) {\r\n                    this.detail = res.data.data;\r\n                    this.detailBanner = this.detail.kechengtupian ? this.detail.kechengtupian.split(',') : [];\r\n\r\n                    await this.getCourseVideos();\r\n\r\n                    if (this.courseVideos.length > 0) {\r\n                        let lastViewedVideoId = await this.findLastViewedVideoId();\r\n                        if (lastViewedVideoId) {\r\n                            this.playSelectedVideo(lastViewedVideoId);\r\n                        } else {\r\n                            this.playSelectedVideo(this.courseVideos[0].id);\r\n                        }\r\n                    } else if (this.detail.kechengshipin) {\r\n                        this.currentSessionId = this.id;\r\n                        this.currentVideoUrl = this.detail.kechengshipin;\r\n                        this.currentVideoTitle = this.detail.kechengmingcheng;\r\n                        this.$nextTick(async () => {\r\n                            await this.restoreProgress(this.currentSessionId);\r\n                            if (this.$refs.videoPlayer && this.$refs.videoPlayer.paused) {\r\n                                this.$refs.videoPlayer.play().catch(e => console.warn(\"视频播放失败或用户未交互:\", e));\r\n                            }\r\n                        });\r\n                    }\r\n\r\n                    // 4. Fetch storeup and thumbsup status if user is logged in\r\n                    if (this.userId) {\r\n                        this.getStoreupStatus();\r\n                        this.getThumbsupOrCrazilyStatus();\r\n                    }\r\n\r\n                } else {\r\n                    console.error(\"获取课程详情失败:\", res.data.msg || '未知错误');\r\n                }\r\n            } catch (error) {\r\n                console.error(\"请求课程详情接口出错:\", error);\r\n            }\r\n\r\n\r\n        },\r\n\r\n        async getCourseVideos() {\r\n            try {\r\n                const videosRes = await this.$http.get('coursevideos/listByCourseId', { params: { courseId: this.id } });\r\n                if (videosRes.data && videosRes.data.code === 0 && videosRes.data.data) {\r\n                    this.courseVideos = videosRes.data.data;\r\n                } else {\r\n                    console.warn(\"获取课程视频章节失败:\", videosRes.data.msg || \"未知错误\");\r\n                    this.courseVideos = [];\r\n                }\r\n            } catch (error) {\r\n                console.error(\"请求课程视频列表接口出错:\", error);\r\n                this.courseVideos = [];\r\n            }\r\n        },\r\n\r\n        async findLastViewedVideoId() {\r\n            if (!this.userId || this.courseVideos.length === 0) return null;\r\n\r\n            // Iterate through videos to find if any has saved progress\r\n            for (const video of this.courseVideos) {\r\n                try {\r\n                    const progressRes = await this.$http.get('courseprogress/getOne', {\r\n                        params: {\r\n                            courseId: this.id,\r\n                            videoId: video.id\r\n                        }\r\n                    });\r\n                    if (progressRes.data && progressRes.data.code === 0 && progressRes.data.data && progressRes.data.data.progressSeconds > 0) {\r\n                        return video.id; // Return the ID of the first video with progress\r\n                    }\r\n                } catch (error) {\r\n                    console.error(`检查视频 ${video.id} 进度时出错:`, error);\r\n                }\r\n            }\r\n            return null; // No video with saved progress found\r\n        },\r\n\r\n        // Play selected video (for multi-chapter courses)\r\n        playSelectedVideo(videoId) {\r\n            const selectedVideo = this.courseVideos.find(video => video.id === videoId);\r\n            if (selectedVideo) {\r\n                this.currentSessionId = selectedVideo.id;\r\n                this.currentVideoUrl = selectedVideo.videoUrl;\r\n                this.currentVideoTitle = `${selectedVideo.courseSession || ''} - ${selectedVideo.title || '无标题'}`;\r\n                console.log(`正在播放视频: ${this.currentVideoUrl}`);\r\n                this.$nextTick(async () => {\r\n                    await this.restoreProgress(this.currentSessionId);\r\n                    if (this.$refs.videoPlayer && this.$refs.videoPlayer.paused) {\r\n                        this.$refs.videoPlayer.play().catch(e => console.warn(\"视频播放失败或用户未交互\", e));\r\n                    }\r\n                });\r\n            }\r\n        },\r\n\r\n        getFileNameFromUrl(url) {\r\n            if (!url) return '';\r\n            const parts = url.split('/');\r\n            return parts[parts.length - 1];\r\n        },\r\n\r\n        downloadDocument() {\r\n            const pdfUrl = this.detail.contentpdfurl;\r\n            if (pdfUrl) {\r\n                const documentFileName = this.getFileNameFromUrl(pdfUrl);\r\n                const link = document.createElement('a');\r\n                link.href = pdfUrl;\r\n\r\n                link.setAttribute('download', documentFileName);\r\n                document.body.appendChild(link);\r\n                link.click();\r\n                document.body.removeChild(link);\r\n\r\n                console.log(`正在下载文档: ${documentFileName}`);\r\n            } else {\r\n                this.$message.warning('没有可下载的文档。');\r\n            }\r\n        },\r\n\r\n        // Video playback events\r\n        onTimeUpdate() {\r\n            if (this.userId && this.currentSessionId && this.$refs.videoPlayer) {\r\n                // Save progress every 5 seconds (or adjust frequency)\r\n                if (Math.floor(this.$refs.videoPlayer.currentTime) % 5 === 0 && Math.floor(this.$refs.videoPlayer.currentTime) !== 0) {\r\n                    this.saveProgress(this.currentSessionId, this.$refs.videoPlayer.currentTime, this.$refs.videoPlayer.duration);\r\n                }\r\n            }\r\n        },\r\n        onVideoEnded() {\r\n            if (this.userId && this.currentSessionId && this.$refs.videoPlayer) {\r\n                // Save progress at 0 (or total duration) when video ends\r\n                this.saveProgress(this.currentSessionId, this.$refs.videoPlayer.duration || 0, this.$refs.videoPlayer.duration);\r\n            }\r\n        },\r\n\r\n        // Save video playback progress to backend\r\n        async saveProgress(videoId, currentTime, totalDuration) {\r\n            if (!this.userId || !videoId || !this.$refs.videoPlayer) {\r\n                return;\r\n            }\r\n\r\n            const progressData = {\r\n                userId: this.userId,\r\n                courseId: Number(this.id), // Ensure it's Number type\r\n                videoId: Number(videoId), // Use the actual video ID for tracking\r\n                progressSeconds: currentTime,\r\n                totalSeconds: totalDuration // Can send total duration if you want to store it\r\n            };\r\n\r\n            try {\r\n                const res = await this.$http.post('courseprogress/saveOrUpdate', progressData);\r\n                if (res.data.code === 0) {\r\n                    // console.log(\"学习进度已保存:\", currentTime);\r\n                } else {\r\n                    console.error(\"保存学习进度失败:\", res.data.msg);\r\n                }\r\n            } catch (error) {\r\n                console.error(\"请求保存进度接口出错:\", error);\r\n            }\r\n        },\r\n\r\n        // Restore video playback progress from backend\r\n        async restoreProgress(videoId) {\r\n            if (!this.userId || !videoId || !this.$refs.videoPlayer) {\r\n                return;\r\n            }\r\n            try {\r\n                const res = await this.$http.get('courseprogress/getOne', {\r\n                    params: {\r\n                        courseId: this.id,\r\n                        videoId: videoId // Request specific video progress\r\n                    }\r\n                });\r\n                const data = res.data;\r\n                if (data.code === 0 && data.data && data.data.progressSeconds > 0) {\r\n                    this.$refs.videoPlayer.currentTime = parseFloat(data.data.progressSeconds);\r\n                    console.log(`恢复进度: 用户 ${this.userId}, 课程 ${this.id}, 视频 ${videoId}, 时间 ${data.data.progressSeconds}`);\r\n                } else {\r\n                    this.$refs.videoPlayer.currentTime = 0; // No progress found, start from beginning\r\n                }\r\n            } catch (error) {\r\n                console.error(\"请求获取进度接口出错:\", error);\r\n                this.$refs.videoPlayer.currentTime = 0; // Fallback to start from beginning on error\r\n            }\r\n        },\r\n\r\n        // ... (Keep all your other existing methods: onAcross, storeup, getStoreupStatus, thumbsupOrCrazily, cancelThumbsupOrCrazily, getThumbsupOrCrazilyStatus, backClick, download, btnAuth, editClick, delClick)\r\n        onAcross(tableName, crossOptAudit, compareKey, compareValue, id) {\r\n            if (this.userId) { // 确保用户ID存在\r\n                this.$router.push({\r\n                    path: `/index/${tableName}`,\r\n                    query: {\r\n                        crossOptAudit: crossOptAudit,\r\n                        compareKey: compareKey,\r\n                        compareValue: compareValue,\r\n                        id: id\r\n                    }\r\n                })\r\n            } else {\r\n                this.$message.error('请先登录后操作');\r\n            }\r\n        },\r\n        async storeup(status) {\r\n            if (!this.userId) {\r\n                this.$message.error('请先登录后操作');\r\n                return\r\n            }\r\n            this.storeupParams.userid = this.userId;\r\n            this.storeupParams.name = this.detail.kechengmingcheng;\r\n            this.storeupParams.picture = this.detail.kechengtupian;\r\n            this.storeupParams.refid = this.id;\r\n            let res = await this.$http.post('storeup/add', this.storeupParams, { params: { type: status } });\r\n            if (res.data.code == 0) {\r\n                this.detail.storeupnum = res.data.data;\r\n                if (status == 1) {\r\n                    this.isStoreup = true;\r\n                } else {\r\n                    this.isStoreup = false;\r\n                }\r\n            } else {\r\n                this.$message.error(res.data.msg || '操作失败');\r\n            }\r\n        },\r\n        async getStoreupStatus() {\r\n            if (!this.userId) return;\r\n            let params = {\r\n                userid: this.userId,\r\n                refid: this.id,\r\n                tablename: 'kechengxinxi',\r\n                type: 1\r\n            }\r\n            let res = await this.$http.get('storeup/list', { params: params });\r\n            if (res.data.code == 0 && res.data.data.list && res.data.data.list.length > 0) {\r\n                this.isStoreup = true;\r\n            } else {\r\n                this.isStoreup = false;\r\n            }\r\n        },\r\n        async thumbsupOrCrazily(type) {\r\n            if (!this.userId) {\r\n                this.$message.error('请先登录后操作');\r\n                return\r\n            }\r\n            this.thumbsupOrCrazilyInfo.userid = this.userId;\r\n            this.thumbsupOrCrazilyInfo.refid = this.id;\r\n            this.thumbsupOrCrazilyInfo.type = type;\r\n            this.thumbsupOrCrazilyInfo.tablename = this.tablename;\r\n            this.thumbsupOrCrazilyInfo.name = this.detail.kechengmingcheng;\r\n            this.thumbsupOrCrazilyInfo.picture = this.detail.kechengtupian;\r\n\r\n            let res = await this.$http.post('storeup/add', this.thumbsupOrCrazilyInfo);\r\n            if (res.data.code == 0) {\r\n                if (type == 21) {\r\n                    this.detail.thumbsupnum = res.data.data;\r\n                    this.isThumbsupnum = true;\r\n                    this.isCrazilynum = false;\r\n                } else {\r\n                    this.detail.crazilynum = res.data.data;\r\n                    this.isCrazilynum = true;\r\n                    this.isThumbsupnum = false;\r\n                }\r\n                this.$message.success('操作成功!');\r\n            } else {\r\n                this.$message.error(res.data.msg || '操作失败');\r\n            }\r\n        },\r\n        async cancelThumbsupOrCrazily(type) {\r\n            if (!this.userId) {\r\n                this.$message.error('请先登录后操作');\r\n                return\r\n            }\r\n            let params = {\r\n                userid: this.userId,\r\n                refid: this.id,\r\n                tablename: this.tablename,\r\n                type: type\r\n            }\r\n            let resList = await this.$http.get('storeup/list', { params: params });\r\n            if (resList.data.code == 0 && resList.data.data.list.length > 0) {\r\n                let delId = resList.data.data.list[0].id;\r\n                let res = await this.$http.post('storeup/delete', [delId]);\r\n                if (res.data.code == 0) {\r\n                    if (type == 21) {\r\n                        this.detail.thumbsupnum = res.data.data;\r\n                        this.isThumbsupnum = false;\r\n                    } else {\r\n                        this.detail.crazilynum = res.data.data;\r\n                        this.isCrazilynum = false;\r\n                    }\r\n                    this.$message.success('取消成功!');\r\n                } else {\r\n                    this.$message.error(res.data.msg || '取消失败');\r\n                }\r\n            } else {\r\n                this.$message.error('未找到可取消的记录');\r\n            }\r\n        },\r\n        async getThumbsupOrCrazilyStatus() {\r\n            if (!this.userId) return;\r\n            let params = {\r\n                userid: this.userId,\r\n                refid: this.id,\r\n                tablename: this.tablename\r\n            }\r\n            let resThumbsup = await this.$http.get('storeup/list', { params: { ...params, type: 21 } });\r\n            if (resThumbsup.data.code == 0 && resThumbsup.data.data.list && resThumbsup.data.data.list.length > 0) {\r\n                this.isThumbsupnum = true;\r\n                this.thumbsupOrCrazilyInfo = resThumbsup.data.data.list[0];\r\n            } else {\r\n                this.isThumbsupnum = false;\r\n            }\r\n\r\n            let resCrazily = await this.$http.get('storeup/list', { params: { ...params, type: 22 } });\r\n            if (resCrazily.data.code == 0 && resCrazily.data.data.list && resCrazily.data.data.list.length > 0) {\r\n                this.isCrazilynum = true;\r\n                this.thumbsupOrCrazilyInfo = resCrazily.data.data.list[0];\r\n            } else {\r\n                this.isCrazilynum = false;\r\n            }\r\n        },\r\n        backClick() {\r\n            this.$router.go(-1);\r\n        },\r\n        download(file) {\r\n            window.location.href = this.baseUrl + file\r\n        },\r\n        btnAuth(tablename, key) {\r\n            if (!key) return true;\r\n            if (!this.$store.state.user || !this.$store.state.user.session || !this.$store.state.user.session.menuList) return false\r\n            return this.$store.state.user.session.menuList.filter(item => {\r\n                if (item.tablename == tablename && item.buttonname == key) {\r\n                    return true;\r\n                } else return false;\r\n            }).length > 0\r\n        },\r\n        editClick() {\r\n            this.$router.push('/index/' + this.tablename + '/add/' + this.id)\r\n        },\r\n        async delClick() {\r\n            this.$confirm('确定要删除吗?', '提示', {\r\n                confirmButtonText: '确定',\r\n                cancelButtonText: '取消',\r\n                type: 'warning'\r\n            }).then(async () => {\r\n                let res = await this.$http.post(this.tablename + '/delete', [this.id]);\r\n                if (res.data.code == 0) {\r\n                    this.$message({\r\n                        message: '删除成功',\r\n                        type: 'success',\r\n                        duration: 500,\r\n                        onClose: () => {\r\n                            this.$router.go(-1);\r\n                        }\r\n                    });\r\n                } else {\r\n                    this.$message.error(res.data.msg || '删除失败');\r\n                }\r\n            });\r\n        },\r\n        async getDetail() {\r\n            let res = await this.$http.get('kechengxinxi/detail/' + this.id);\r\n            this.detail = res.data.data;\r\n            if (this.detail.contentpdfurl) {\r\n                this.contentpdfurl = this.detail.contentpdfurl;\r\n            }\r\n        },\r\n    }\r\n};\r\n</script>\r\n\r\n<style rel=\"stylesheet/scss\" lang=\"scss\" scoped>\r\n/* Your existing styles */\r\n</style>"]}]}